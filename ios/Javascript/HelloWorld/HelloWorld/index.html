<!doctype html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <title>iOS WKWebview Sample</title>
</head>

<body>
<header style="text-align: center; padding-top: 20px;">
    <h1>iOS WKWebview</h1>
</header>
<hr>
<div class="container" style="margin-top: 300px; padding: 0 10px; text-align: center;">
    <button id="start" class="layui-btn" style="margin: 5px 0; display: none;">Start Scan</button>
    <button id="stop" class="layui-btn" style="margin: 5px 0;">Stop Scan</button>
    <h4 id="results"></h4>
</div>

<script>
        class DBRWKWebviewBridge {

            constructor() {
                // The following two properties 'startScanning' and 'stopScanning' are specified in the relevant code of the WKWebView
                if (window.webkit) {
                    this.methodsMap = window.webkit.messageHandlers;
                    this.setCameraUI = (list) => {
                        this.methodsMap.setCameraUI.postMessage(list);
                    };
                    this.startScanning = () => {
                        this.methodsMap.startScanning.postMessage("");
                    };
                    this.stopScanning = () => {
                        this.methodsMap.stopScanning.postMessage("");
                    };
                }
                 else {
                    this.methodsMap = null;
                }
                // callback when the barcode results are returned
                this.onBarcodeRead = () => { };
            }

            setBarcodeReadCallback(callback) {
                this.onBarcodeRead = callback;
            }
        }

        const wkWebviewBridge = new DBRWKWebviewBridge();
        const startBtn = document.getElementById("start");
        const stopBtn = document.getElementById("stop");
        
        
        if (!wkWebviewBridge.methodsMap) {
            console.log("Can't get 'window.webkit'");
        } else {
            wkWebviewBridge.setBarcodeReadCallback(result => {
                document.getElementById("results").innerText = result;
            });
            
            // set the position of the CameraView
            // [marginLeft, marginTop, width, height] / px
            wkWebviewBridge.setCameraUI([95, 230, 220, 220]);
            
            startBtn.addEventListener("click", () => {
                startBtn.style.display = "none";
                stopBtn.style.display = "inline-block";
                wkWebviewBridge.startScanning();
            });
            stopBtn.addEventListener("click", () => {
                startBtn.style.display = "inline-block";
                stopBtn.style.display = "none";
                wkWebviewBridge.stopScanning();
            });
        }

    </script>
</body>

</html>
